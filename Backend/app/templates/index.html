{% extends 'base.html' %}

{% block title %} Home {% endblock %}

{% block header %}
<h1>Pantry Plus2</h1>
{% if current_user.is_authenticated %}
<h6>Nice to see you again, {{ current_user.username.title() }}!</h6>
<div class="container" style="border-radius: 0;">
    <div class="col12-col-lg-4 order-0 order-lg-1">
        <form action="" method="POST">
            {{ form.csrf_token }}
            {{ form.search_term.label }} {{ form.search_term() }}
            {{ form.submit() }}
        </form>
    </div>
</div>
{% else %}
<h6>Please Sign Up or Log In to Create or Update Address Books</h6>
{% endif %}
{% endblock %}

{% block content %}

<head><title>Ex.DataStorage | "12 Homepage Recipe Items"</title>
   
    <div class="container" style="border-radius: 0">
        <div class="row row-cols-1 row-cols-md-3 mt-3 ">
            {% for recipe in recipes %}
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="{{ recipe.image }}" class="card-img-top"
                        alt="{{ recipe.title }}">
                    <div class="card-body">
                        <h6 class="card-title">{{ recipe.title }}</h6>
                        <a href="{{ 'https://spoonacular.com/recipes/' + recipe.title.split(' ')|join('-') + '-' + recipe.id|string }}"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-outline-success w-60 ml-4 mt-2" style="width: 8rem;">
                            View on Spoonacular
                        </a>

                        <a href="{{ recipe.link }}" target="_blank"
                            class="btn btn-primary">View Recipe</a>
                    {% if current_user.is_authenticated %}
                    <form method="post" action="{{ url_for('search') }}">

                        {{ form.csrf_token }}
                        <!-- {% if current_user in recipe.favorited_by.all() %} -->
                        <input type="submit" value="Unfavorite" class="btn btn-danger">
                        {% else %}
                        <input type="submit" value="Favorite" class="btn btn-success">
                        {% endif %}
                    </form>
                    {% endif %}

                    </div>
                </div>
            </div>
            {% endfor %}
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/640803-312x231.jpg"
                        class="card-img-top" alt="Fried Chicken">
                    <div class="card-body">
                        <h6 class="card-title">Crispy Buttermilk Fried Chicken
                        </h6>
                        <a href="https://spoonacular.com/recipes/crispy-buttermilk-fried-chicken-640803"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                        <a href="https://spoonacular.com/recipes/crispy-buttermilk-fried-chicken-640803"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>


                    </div>
                </div>
            </div>
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/641717-312x231.jpg"
                        class="card-img-top" alt="Duck Rumaki">
                    <div class="card-body">
                        <h6 class="card-title">Duck Rumaki</h6>
                        <a href="https://spoonacular.com/recipes/Duck-Rumaki-641717"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/633314-312x231.jpg"
                        class="card-img-top" alt="Bacon Ice Cream">
                    <div class="card-body">
                        <h6 class="card-title">Bacon Ice Cream</h6>
                        <a href="https://spoonacular.com/recipes/Bacon-Ice-Cream-633314"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/1747693-312x231.jpg"
                        class="card-img-top"
                        alt="Your Basic Low Carb Breakfast">
                    <div class="card-body">
                        <h6 class="card-title">Your Basic Low Carb Breakfast
                        </h6>
                        <a href="https://spoonacular.com/recipes/Your-Basic-Low-Carb-Breakfast-1747693"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/715574-312x231.jpg"
                        class="card-img-top" alt="Homemade Strawberry Shake">
                    <div class="card-body">
                        <h6 class="card-title">Homemade Strawberry Shake</h6>
                        <a href="https://spoonacular.com/recipes/Homemade-Strawberry-Shake-715574"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/649722-312x231.jpg"
                        class="card-img-top" alt="Lemon Pepper Steak">
                    <div class="card-body">
                        <h6 class="card-title">Lemon Pepper Steak</h6>
                        <a href="https://spoonacular.com/recipes/Lemon-Pepper-Steak-649722"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>

            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/650755-312x231.jpg"
                        class="card-img-top"
                        alt="Mango Black Tea Skinny Cocktai">
                    <div class="card-body">
                        <h6 class="card-title">Mango Black Tea Skinny Cocktai
                        </h6>
                        <a href="https://spoonacular.com/recipes/Mango-Black-Tea-Skinny-Cocktail-650755"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/633338-312x231.jpg"
                        class="card-img-top" alt="Bacon Wrapped Filet Mignon">
                    <div class="card-body">
                        <h6 class="card-title">Bacon Wrapped Filet Mignon</h6>
                        <a href="https://spoonacular.com/recipes/Bacon-Wrapped-Filet-Mignon-633338"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/640370-312x231.jpg"
                        class="card-img-top"
                        alt="Cranberry Fettuccine Tomato Cream Sauce With Shrimps and Scallops">
                    <div class="card-body">
                        <h6 class="card-title">Cranberry Fettuccine Tomato Cream
                            Sauce With Shrimps and Scallops</h6>
                        <a href="https://spoonacular.com/recipes/Cranberry-Fettuccine-Tomato-Cream-Sauce-With-Shrimps-and-Scallops-640370"
                            target="_blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/658126-312x231.jpg"
                        class="card-img-top" alt="Red Wine Stewed Oxtail">
                    <div class="card-body">
                        <h6 class="card-title">Red Wine Stewed Oxtail</h6>
                        <a href="https://spoonacular.com/recipes/Red-Wine-Stewed-Oxtail-658126"
                            target="
                        target=" _blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/646424-312x231.jpg"
                        class="card-img-top"
                        alt="Healthier Southern-Style Green Beans">
                    <div class="card-body">
                        <h6 class="card-title">Healthier Southern-Style Green
                            Beans</h6>
                        <a href="https://spoonacular.com/recipes/Healthier-Southern-Style-Green-Beans-646424"
                            target="
                        target=" _blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>
            <div class="col mb-4">
                <div class="card h-100">
                    <img src="https://spoonacular.com/recipeImages/649495-312x231.jpg"
                        class="card-img-top"
                        alt="Lemon and Garlic Slow Roasted Chicken">
                    <div class="card-body">
                        <h6 class="card-title">Lemon and Garlic Slow Roasted
                            Chicken"</h6>
                        <a href="https://spoonacular.com/recipes/Lemon-and-Garlic-Slow-Roasted-Chicken-649495"
                            target="
                        target=" _blank" rel="noopener noreferrer"
                            class="btn btn-primary">View Recipe</a>
                    </div>
                </div>
            </div>
        </div>

    
</head>


<div class="row d-flex justify-content-center">
    <!-- Left 2/3 Column -->
    <div class="col-12 col-lg-8 order-1 order-lg-0">

        {% for recipe in recipes %}
        <div class="card mt-3">
            <div class="row g-0">
                <div class="col-md-4">
                </div>

                <div class="card-body">

                    <h6 class="card-title">{{ recipe.title }}</h6>

                    <p class="card-text">{{ recipe.title }}<br>
                        {{recipe.id }}<br>

                    <h6 class="card-subtitle text-muted">Date Added: {{
                        recipe.date_created}}</h6>

                    {% if recipe.user %}
                    {% if recipe.user == current_user %}
                    <small class="card-subtitle">By: You</small>
                    {% else %}
                    <small class="card-subtitle">By: {{
                        recipe.user.username.title() }}</small>
                    {% endif %}
                    {% else %}
                    <small class="card-subtitle">By: Unknown</small>
                    {% endif %}
                    <div class="card-footer bg-white-subtle">
                        {% if recipe.user == current_user %}
                        <a href="{{ url_for('edit_recipe', recipe_id=recipe.id) }}"
                            class="btn btn-success">Edit</a>
                        <!-- Button trigger modal -->
                        <button type="button" class="btn btn-danger"
                            data-bs-toggle="modal"
                            data-bs-target="#deleterecipeModal-{{ recipe.id }}">
                            Delete
                        </button>
                    {% if current_user.is_authenticated %}
                    <form action="{{ url_for('toggle_favorite', recipe_id=recipe.id) }}"
                        method="POST">
                        <button type="submit" class="btn btn-warning">
                            {% if current_user in recipe.favorited_by.all() %}
                            Unfavorite
                            {% else %}
                            Favorite
                            {% endif %}
                        </button>
                    </form>
                    {% endif %}
                            </button>
                        </form>
                  

                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="deleterecipeModal-{{ recipe.id }}"
            tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">
                            Delete {{ recipe.title, recipe.id }}?
                        </h1>
                        <button type="button" class="btn-close"
                            data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete {{ recipe.title,
                        recipe.date_created }}? This
                        action cannot be undone.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"
                            data-bs-dismiss="modal">Close</button>
                        <a href="{{ url_for('delete_recipe', recipe_id=recipe.id) }}"
                            class="btn btn-danger">Delete Recipe</a>

                    </div>
                </div>
            </div>
        </div>
        {% endfor %}


    </div>
</div>
</div>


</div>
</div>

{% endblock %}